# Excel导入稽核功能实现说明

## ✅ 功能实现完成：

### 🎯 功能描述：
实现了Excel文件导入功能，当用户上传包含"单位"和"稽核规则"表头的Excel文件时，系统能够根据页面中已有的稽核规则逻辑来生成稽核结果。

### 🔧 实现的功能：

#### 1. **Excel文件导入**：
- ✅ 支持`.xlsx`和`.xls`格式
- ✅ 验证文件必须包含"单位"和"稽核规则"列
- ✅ 自动解析Excel数据并匹配稽核规则

#### 2. **稽核规则库**：
```typescript
const auditRuleLibrary = [
  {
    type: '账务处理',
    rule: '100201银行存款与基本账户存款与80010202货币资金-银行存款一致性比对',
    formula: '100201=A, 80010202=B, if "A-B"≠0, false',
    description: '银行存款科目与货币资金科目余额一致性检查'
  },
  {
    type: '预算管理',
    rule: '中央财政项目收入与预算控制数一致性比对',
    formula: '项目收入=A, 预算控制数=B, if "A-B"<0, false',
    description: '项目收入与预算控制数一致性检查'
  },
  // ... 更多规则
]
```

#### 3. **稽核规则匹配**：
- ✅ 基于关键词匹配（科目代码、业务术语）
- ✅ 支持账务处理和预算管理两类规则
- ✅ 智能识别规则类型并生成相应结果

#### 4. **稽核结果生成**：
- ✅ 账务处理规则：科目余额一致性比对
- ✅ 预算管理规则：收入与预算控制数比对
- ✅ 自动计算差值并判断是否合规

### 📊 稽核规则规律分析：

#### 1. **账务处理规则规律**：
```
规则格式：科目代码A与科目代码B一致性比对
公式格式：A=值A, B=值B, if "A-B"≠0, false
结果格式："科目代码A"=值A, "科目代码B"=值B; 值A-值B=差值, true/false
```

#### 2. **预算管理规则规律**：
```
规则格式：业务项目A与业务项目B一致性比对
公式格式：A=值A, B=值B, if "A-B"<0, false
结果格式：项目A=值A, 项目B=值B, 值A-值B=差值, true/false
```

### 🚀 使用流程：

#### 1. **准备Excel文件**：
Excel文件必须包含以下列：
- **单位**：单位名称
- **稽核规则**：规则描述（包含关键词）

#### 2. **导入操作**：
1. 点击"导入"按钮
2. 选择Excel文件
3. 系统自动验证文件格式
4. 匹配稽核规则并生成结果
5. 结果显示在表格中

#### 3. **结果查看**：
- 单位：导入的单位名称
- 稽核规则：匹配的规则类型和描述
- 稽核结果：具体的比对结果和合规性判断

### 📋 示例Excel数据：

#### **示例1：账务处理规则**
| 单位 | 稽核规则 |
|------|----------|
| XX中心 | 100201银行存款与80010202货币资金一致性比对 |
| XX市气象局 | 1122应收账款与2203预收账款余额一致性比对 |

**预期结果**：
```
单位: XX中心
稽核规则: 账务处理:100201银行存款与基本账户存款与80010202货币资金-银行存款一致性比对
稽核结果: "100201"=56398, "80010202"=57429; 56398-57429=-1031, false
```

#### **示例2：预算管理规则**
| 单位 | 稽核规则 |
|------|----------|
| XX中心 | 项目收入与预算控制数一致性比对 |
| XX市气象局 | 预算执行进度与计划进度一致性比对 |

**预期结果**：
```
单位: XX中心
稽核规则: 预算管理:中央财政项目收入与预算控制数一致性比对
稽核结果: 项目收入=520000, 预算控制数=550000, 520000-550000=-30000, false
```

### 🔍 技术实现：

#### 1. **文件处理**：
```typescript
// 使用xlsx库解析Excel文件
const workbook = XLSX.read(data, { type: 'array' })
const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 })
```

#### 2. **规则匹配**：
```typescript
// 基于关键词匹配稽核规则
const findMatchingRule = (ruleText: string) => {
  return auditRuleLibrary.value.find(rule => {
    // 检查科目代码和关键词匹配
    if (ruleKeywords.includes('100201') && keywords.includes('100201')) return true
    // ... 更多匹配逻辑
  })
}
```

#### 3. **结果生成**：
```typescript
// 根据规则类型生成不同结果
const generateAuditResult = (unit, rule, row, headers) => {
  switch (rule.type) {
    case '账务处理': return generateAccountingResult(rule)
    case '预算管理': return generateBudgetResult(rule)
  }
}
```

### 📝 测试用例：

#### **测试数据1**：
```
单位: XX中心
稽核规则: 100201银行存款与80010202货币资金一致性比对
```

**预期输出**：
```
稽核结果: "100201"=56398, "80010202"=57429; 56398-57429=-1031, false
```

#### **测试数据2**：
```
单位: XX市气象局
稽核规则: 项目收入与预算控制数一致性比对
```

**预期输出**：
```
稽核结果: 项目收入=520000, 预算控制数=550000, 520000-550000=-30000, false
```

### ⚠️ 注意事项：

1. **文件格式**：Excel文件必须包含"单位"和"稽核规则"列
2. **规则匹配**：稽核规则描述必须包含系统识别的关键词
3. **数据生成**：当前使用模拟数据，实际应用需要从Excel中提取真实数值
4. **规则扩展**：可以轻松添加新的稽核规则到规则库中

### 🎯 功能特点：

- ✅ **智能匹配**：基于关键词自动匹配稽核规则
- ✅ **类型识别**：自动识别账务处理和预算管理规则
- ✅ **结果生成**：自动计算并生成稽核结果
- ✅ **格式统一**：结果格式与现有数据保持一致
- ✅ **易于扩展**：可以轻松添加新的稽核规则

现在用户可以通过导入Excel文件来自动生成稽核结果，系统会根据文件中的"单位"和"稽核规则"信息，自动匹配相应的规则并生成稽核结果！
